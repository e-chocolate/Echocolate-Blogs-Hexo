---
title: 实现V2ray流量统计
date: 2021-05-19 21:08:00
---

　　最近将自己搭建的v2ray服务借给朋友使用，同时也正在考虑将v2ray服务租给有需要的人使用，毕竟每个月的服务器费用也是个不小的花费。考虑到VPS每个月有流量限制，之前自己一个人使用基本上是用不完的，但是一旦借给的人多了，就担心流量超标的问题，因此不得不对每一个用户进行流量统计。
　　好在v2ray的官方文档以及白话文手册都有介绍如何进行流量统计，实现起来也不是很难，简单记录一下。
　　v2ray的配置具体见官方文档，此处不在赘述，主要讲一下如何利用v2ray提供的工具进行流量的查询与统计。
　　查询所有流量信息`v2ctl api --server=127.0.0.1:49988 StatsService.QueryStats 'pattern: "" reset: false'`，`reset: false`表示查询时不重置流量。
　　查询结果如下：
```ini
stat: <
  name: "inbound>>>api>>>traffic>>>uplink"
  value: 616
>
stat: <
  name: "inbound>>>api>>>traffic>>>downlink"
  value: 1423
>
stat: <
  name: "outbound>>>traffic_out>>>traffic>>>uplink"
  value: 18438
>
stat: <
  name: "outbound>>>traffic_out>>>traffic>>>downlink"
  value: 10526741
>
stat: <
  name: "user>>>Yuki>>>traffic>>>uplink"
  value: 18438
>
stat: <
  name: "user>>>Yuki>>>traffic>>>downlink"
  value: 10526741
>
stat: <
  name: "inbound>>>traffic_in>>>traffic>>>uplink"
  value: 21898
>
stat: <
  name: "inbound>>>traffic_in>>>traffic>>>downlink"
  value: 10824585
>
```
　　也可以查询某一个用户的上行或者下行的流量`v2ctl api --server=127.0.0.1:49988 StatsService.GetStats 'name:"user>>>Yuki>>>traffic>>>downlink"'`
```ini
stat: <
  name: "user>>>Yuki>>>traffic>>>downlink"
  value: 6277
>
```
　　可见v2ray官方就帮我们进行了流量统计，我们可以借用awk工具处理官方统计结果。
<div class="reply2view" style="font-weight:bolder; color:#336699;">您需要<a id="comment_show" href="#comments">回复</a>才能显示此处隐藏内容。</div>