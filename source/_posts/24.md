---
title: 基于正则表达式隐藏博客内容
date: 2022-07-20 00:46:00
---

　　目前 Typecho 只支持将整个文章的内容隐藏，很多时候只需要隐藏文章的部分内容，既然官方没有提供这个功能，那就自己实现一下。
　　设计思路也很简单：
1. 设定隐藏标记，在隐藏标记之间的内容被隐藏
2. 解析文章内容，若当前用户可以访问隐藏内容，则将隐藏标记去掉
3. 解析文章内容，若当前用户不可以访问隐藏内容，则将隐藏标记去掉同时替换隐藏标记之间的文本

　　<div class="reply2view" style="font-weight:bolder; color:#336699;">您需要<a id="comment_show" href="#comments">回复</a>才能显示此处隐藏内容。</div>
　　最终实现效果如下：在写博客时，只需要遵守下面的语法就可以实现**隐藏内容**的效果。
> &lsqb;hide&rsqb;
> 该部分内容需回复可见
> &lsqb;/hide&rsqb;
> &lsqb;login&rsqb;
> 该部分内容仅登录可见
> &lsqb;/login&rsqb;

　　插件的使用方法如下：
1. 替换`post.php`中文章内容输出语句
2. 自定义**登录**点击事件（可选）


　　首先是替换内容输出语句，在主题文件夹下`post.php`中找到文章内容输出语句，以`default`主题为例：
```php
<div class="post-content" itemprop="articleBody">
    <?php parseContnet($this->content); ?>
</div>
```

　　我们在`div`区块间加入文章内容替换语句
```php
<?php
    if (array_key_exists('Hide', Typecho_Plugin::export()['activated'])) {
        $this->content = Hide_Plugin::parse_content($this->content, $this->cid, $this->remember('mail',true), $this->user->hasLogin(), $this->options->adminUrl);
    }
?>
```

　　最后`post.php`文件内容如下（仅输出文章内容部分）：
```php
<div class="post-content" itemprop="articleBody">
    <?php
        if (array_key_exists('Hide', Typecho_Plugin::export()['activated'])) {
            $this->content = Hide_Plugin::parse_content($this->content, $this->cid, $this->remember('mail',true), $this->user->hasLogin(), $this->options->adminUrl);
        }
    ?>
    <?php parseContnet($this->content); ?>
</div>
```

　　然后需要绑定评论点击事件，事件需要被添加在`footer.php`中`<body>`块中
```php
<?php if (array_key_exists('Hide', Typecho_Plugin::export()['activated'])) : Hide_Plugin::commentClick(); endif; ?>
```

　　以`default`主题为例，可在如下位置插入点击事件语句：
```php
<?php $this->footer(); ?>
<?php if (array_key_exists('Hide', Typecho_Plugin::export()['activated'])) : Hide_Plugin::commentClick(); endif; ?>
</body>
```

　　当内容被隐藏时评论才可见的`HTML`代码如下：
```html
<div class="reply2view" style="font-weight:bolder; color:#336699;">您需要<a id="comment_show" href="#comments">回复</a>才能显示此处隐藏内容。</div>
```

　　我们需要根据这部分代码设计回复点击事件，回复点击事件就是点击**回复**之后会打开评论框，需要根据使用的主题进行微调，**<font color="blue">同时注意在配置界面填写点击事件代码时`<script>`与`</script>`不可省略</font>**。
```php
<script>
$("#comment_show").click(function() {
    $("#comments").fadeIn(1000);
});
</script>
```