---
title: 利用frp访问内网
date: 2021-10-08 21:35:00
---

　　由于 IPv4 地址有限，很多设备（如家用电脑）并不能拥有公网IP，导致这些设备只能在内网中访问，外网中无法访问。好处就是内网设备的安全性相对较高，缺点就是不方便，有时想在外网访问内网的服务（比如自己搭建的家庭云等）就无法访问了。
　　今天介绍一下个人一直在使用的一款用来内网穿透的软件——frp。[frp](https://gofrp.org/) 是一个专注于内网穿透的高性能的反向代理应用，支持 TCP、UDP、HTTP、HTTPS 等多种协议。**可以将内网服务以安全、便捷的方式通过具有公网 IP 节点的中转暴露到公网。**更多的介绍可以去官网查看，下面以 Linux 为例简单写一下frp的安装与使用。
　　frp分为frps和frpc两部分，frps是在服务端运行的，frpc是在客户端运行的，为此我们需要一个具有公网IP的服务端才能使用frp。
## 服务端安装步骤
　　frp的安装也很简单，下载解压即可运行，主要是如何配置，从而使得内网客户端与服务端可以连接来暴露内网客户端的某些服务。具体安装步骤如下：
1. 下载最新版本的frp并解压`tar zxf frp_*.tar.gz && rm -rf frp_*.tar.gz && mv frp* frp`
2. 按个人喜好将frp放在某一路径中`sudo chown -R root:root frp && sudo mv frp /usr/local/ && sudo rm -rf /usr/local/frp/frpc*`
3. 进行服务端的配置`sudo nano /usr/local/frp/frps.ini`
4. 设置日志文件夹权限`sudo mkdir -p /var/log/frp/ && sudo chown -R nobody:nogroup /var/log/frp/`
5. 设置开机自启`sudo nano /etc/systemd/system/frps.service`

　　其中第4，5步按照个人需求来操作，这里贴出一个配置参考，更多的内容可以去官网查看。
<div class="reply2view" style="font-weight:bolder; color:#336699;">您需要<a id="comment_show" href="#comments">回复</a>才能显示此处隐藏内容。</div>
　　需要注意的是，控制台端口如果设为了`127.0.0.1`意味着frp控制台只能由本机进行访问，要想通过IP访问的话，可以设置为`0.0.0.0`。同时贴一下开机自启的配置。
[hide]
```
[Unit]
Description=Frp Server Service
After=network.target

[Service]
Type=simple
User=nobody
Restart=on-failure
RestartSec=5s
ExecStart=/usr/local/frp/frps -c /usr/local/frp/frps.ini

[Install]
WantedBy=multi-user.target

```
[/hide]

## 客户端安装步骤
　　客户端安装和服务端很类似，解压即可运行，但是需要注意配置与服务端相匹配，具体安装步骤如下：
1. 下载最新版本的frp并解压`tar zxf frp_*.tar.gz && rm -rf frp_*.tar.gz && mv frp* frp`
2. 按个人喜好将frp放在某一路径中`sudo chown -R root:root frp && sudo mv frp /usr/local/ && sudo rm -rf /usr/local/frp/frps*`
3. 进行客户端的配置`sudo nano /usr/local/frp/frpc.ini`
4. 设置日志文件夹权限`sudo mkdir -p /var/log/frp/ && sudo chown -R nobody:nogroup /var/log/frp/`
5. 设置开机自启`sudo nano /etc/systemd/system/frpc.service`

　　其中第4，5步按照个人需求来操作，这里贴出一个配置参考，更多的内容可以去官网查看。
[hide]
```
[common]
# 服务端 IP
server_addr = xxx.xxx.xxx.xxx
# 服务器上设置的服务绑定端口(frps.ini 中的 bind_port)
server_port = ******
# 安全授权 token，需与服务端设置一致
token = password

# log设置，可选
log_file = /var/log/frp/frpc.log
log_level = info
log_max_days = 7
disable_log_color = false

# 代理设置，可选
http_proxy = http://127.0.0.1:10809

# [RDP] 
# 反向代理名称，可以随意设置
# RDP 是 TCP 协议的
# type = tcp
# 本机 IP 或内网其它机器的 IP
# local_ip = 127.0.0.1
# 远程桌面的默认端口
# local_port = 3389
# 外网访问的端口
# remote_port = 58877
 
# 如果是linux，可设置 ssh。在控制端就可以用 server_addr:remote_port 作为 ssh 登陆地址
# [ssh]
# type = tcp
# local_ip = 127.0.0.1
# local_port = 22
# remote_port = 57733
# 连接实例 ssh -oPort=57733 root@x.x.x.x
 
# 设置一个 http 服务 web
# [web]
# type = http
# local_port = 80
# custom_domains = frpweb.lzw.me
 
# 设置一个代理服务。在控制端就可以用 server_addr:remote_port 作为代理地址
# [http_proxy]
# type = tcp
# remote_port = 6000
# plugin = http_proxy
```
[/hide]
　　配置中需要注意配置名称不能重复，否则无法与服务端建立连接，同时举了转发rdp端口、ssh端口以及内网web服务的例子，更多内容可以去官网查看。
　　开机自启的内容与服务端的几乎相同，把启动命令改成`ExecStart=/usr/local/frp/frpc -c /usr/local/frp/frpc.ini`即可。