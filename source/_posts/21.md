---
title: MySQL宕机带来的连锁问题
date: 2022-04-05 12:39:00
---

　　为了防止服务器宕机或者别的突发情况，我对我的网站根目录和数据库会进行一周两备。今天检查备份的时候，发现解压出来的备份文件竟然多达3G，而我印象中的所有初始网站程序加起来才500M。
　　于是就怀疑是MySQL的日志空间过大，检查之后发现MySQL日志才十几兆很合理，于是就一个文件夹的查看，发现居然是网站程序目录过大，达到了2G，于是就一个程序一个程序的排查，最后找到了问题源头——lsky图床程序。
```shell
$ du -sh logs/
1.5G    logs/
```
　　[蓝空图床](https://www.lsky.pro/)是一款基于Laravel框架开发的优秀的图床管理程序，该图床本身特性今天先不做过多介绍。最后发现是这个图床的日志文件达到了惊人的1.5G，打开日志一看，全部都是**数据库连接错误**。一个错误日志就达到了120M，记录了将近十天的错误日志，而这些错误日志正是之前MySQL宕机引发的，还好服务器的剩余硬盘空间较大，不然这些错误日志就能把服务器搞瘫痪了。
　　这也给了我一个教训——需要定期检测服务器硬盘情况并清理日志。