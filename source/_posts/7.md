---
title: 服务器禁止恶意IP访问
date: 2021-02-16 14:38:00
---

　　之前设置了服务器日志每5天自动清理并在清理之前归档，一般很少看日志，今天正好看看这几天配置的v2ray运行情况，就顺道想看看服务器运行情况，这不看不知道，一看吓一跳。  
　　一个`103.252.17.146`的IP在短短5分钟的时间内访问了我服务器大约1000次，好家伙，而且每次都是尝试获取敏感词内容，所以在建站的时候就要考虑到尽量不要将常用的网点放在自己虚拟主机的根目录下，好在我的根目录是空主机。尽管每次服务器都返回404或者403，不过这样5分钟1000次的访问量对我的服务器来说也是一个小负担，要是有很多这样的不良攻击者同时采用这种方式来访问我的服务器，我服务器肯定就宕机了，所以有必要采取措施封禁这种恶意访问、恶意攻击的IP。  
　　大致思路是，每隔5或10分钟读取服务器日志文件，根据日志文件中的每个IP的访问请求数量来判断该IP是否是恶意IP，若是恶意IP，就可以利用iptables或者nginx将来自这些IP的访问“deny”掉，同时可以在24小时或者48小时之后将这些IP从黑名单中移除，因为这些IP多半也不是真实IP，具体过程暂时就不写了。